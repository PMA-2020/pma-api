

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pma_api.manage package &mdash; PMA API 1.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> PMA API
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="content/users/usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="content/users/endpoints.html">Endpoints</a></li>
<li class="toctree-l1"><a class="reference internal" href="content/project_developers/project_developers.html">For project developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="content/data_managers/data_managers.html">For data managers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PMA API</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>pma_api.manage package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/pma_api.manage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pma-api-manage-package">
<h1>pma_api.manage package<a class="headerlink" href="#pma-api-manage-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-pma_api.manage.db_mgmt">
<span id="pma-api-manage-db-mgmt-module"></span><h2>pma_api.manage.db_mgmt module<a class="headerlink" href="#module-pma_api.manage.db_mgmt" title="Permalink to this headline">¶</a></h2>
<p>Database management</p>
<dl class="function">
<dt id="pma_api.manage.db_mgmt.aws_s3">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">aws_s3</code><span class="sig-paren">(</span><em>func</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.aws_s3" title="Permalink to this definition">¶</a></dt>
<dd><p>AWS S3 Wrapper</p>
<p>This wrapper is not to be called directly, but should be used in the
following way:</p>
<blockquote>
<div><p>&#64;aws_s3
def my_function_that_uses_s3(…):</p>
<blockquote>
<div>…</div></blockquote>
</div></blockquote>
<dl class="docutils">
<dt>This wrapper provides the following functions:</dt>
<dd><ul class="first last simple">
<li>Offers guidance in the event of connection issues</li>
<li>Prints out status update before calling function</li>
<li>Suppresses buggy, unfixed resource warnings from boto3 S3 client</li>
</ul>
</dd>
<dt>Args:</dt>
<dd>func (function): This will be the function wrapped, e.g.
‘my_function_that_uses_s3’ in the above example.</dd>
<dt>Returns:</dt>
<dd>function: The wrapped function</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.backup_datasets">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">backup_datasets</code><span class="sig-paren">(</span><em>path: str = '/Users/joeflack4/projects/pma-api/data/api_data-2019.01.22-v36-jef.xlsx'</em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#pma_api.manage.db_mgmt.backup_datasets" title="Permalink to this definition">¶</a></dt>
<dd><p>Given path to file on local file system, push file to AWS S3</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path to local file</dd>
<dt>Returns:</dt>
<dd>str: File name of uploaded file</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.backup_db">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">backup_db</code><span class="sig-paren">(</span><em>path: str = ''</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.backup_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Backup database locally and to the cloud</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path to save file</dd>
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>backup_local()</li>
<li>backup_cloud()</li>
</ul>
</dd>
<dt>Returns:</dt>
<dd>str: Path saved locally</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.backup_db_cloud">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">backup_db_cloud</code><span class="sig-paren">(</span><em>path_or_filename: str = ''</em>, <em>silent: bool = False</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.backup_db_cloud" title="Permalink to this definition">¶</a></dt>
<dd><p>Backs up database to the cloud</p>
<p>If path_or_filename is a path, uploads from already stored backup at path.
Else if it is a path_or_filename, creates new backup and then uploads that.</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path_or_filename (str): Either path to a backup file, or file name. If
file name, will restore from local backup if file exists in default
backups directory, else will restore from the cloud.
silent (bool): Don’t print updates?</dd>
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>backup_local()</li>
<li>backup_to_s3()</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.backup_local">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">backup_local</code><span class="sig-paren">(</span><em>path: str = ''</em>, <em>silent: bool = False</em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#pma_api.manage.db_mgmt.backup_local" title="Permalink to this definition">¶</a></dt>
<dd><p>Backup database locally</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path to save file
silent (bool): Don’t print updates?</dd>
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>Saves file at path</li>
</ul>
</dd>
<dt>Raises:</dt>
<dd>PmaApiDbInteractionError: If DB exists and any errors during backup</dd>
<dt>Returns:</dt>
<dd>str: Path to backup file saved</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.backup_local_using_heroku_postgres">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">backup_local_using_heroku_postgres</code><span class="sig-paren">(</span><em>path: str = '/Users/joeflack4/projects/pma-api/data/db_backups/pma-api-backup_MacOS_development_2019-04-23_13-42-27.791668.dump'</em>, <em>app_name: str = ''</em>, <em>silent: bool = False</em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#pma_api.manage.db_mgmt.backup_local_using_heroku_postgres" title="Permalink to this definition">¶</a></dt>
<dd><p>Backup using Heroku PostgreSQL DB using Heroku CLI</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path of file to save
app_name (str): Name of app as recognized by Heroku
silent (bool): Don’t print updates?</dd>
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>Runs command: <cite>heroku pg:backups:capture</cite></li>
<li>Runs command: <cite>heroku pg:backups:download</cite></li>
<li>Downloads to file system</li>
<li>Makes directory (if not exist)</li>
</ul>
</dd>
<dt>Raises:</dt>
<dd>PmaApiDbInteractionError: If errors during process</dd>
<dt>Returns:</dt>
<dd>str: path to backup file saved</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.backup_source_files">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">backup_source_files</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.backup_source_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Backup ui data and datasets</p>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.backup_ui_data">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">backup_ui_data</code><span class="sig-paren">(</span><em>path: str = '/Users/joeflack4/projects/pma-api/data/ui_data-2017.10.02-v4-jef.xlsx'</em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#pma_api.manage.db_mgmt.backup_ui_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Given path to file on local file system, push file to AWS S3</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path to local file</dd>
<dt>Returns:</dt>
<dd>str: File name of uploaded file</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.backup_using_pgdump">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">backup_using_pgdump</code><span class="sig-paren">(</span><em>path: str = '/Users/joeflack4/projects/pma-api/data/db_backups/pma-api-backup_MacOS_development_2019-04-23_13-42-27.791705.dump'</em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#pma_api.manage.db_mgmt.backup_using_pgdump" title="Permalink to this definition">¶</a></dt>
<dd><p>Backup using pg_dump</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path of file to save</dd>
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>Grants full permissions to .pgpass file</li>
<li>Reads and writes to .pgpass file</li>
<li>Runs pg_dump process, storing result to file system</li>
</ul>
</dd>
<dt>Raises:</dt>
<dd>PmaApiDbInteractionError: If errors during process</dd>
<dt>Returns:</dt>
<dd>str: path to backup file saved</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.commit_from_sheet">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">commit_from_sheet</code><span class="sig-paren">(</span><em>ws: xlrd.sheet.Sheet</em>, <em>model: sqlalchemy.ext.declarative.api.Model</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.commit_from_sheet" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize DB table data from XLRD Worksheet.</p>
<p>Initialize table data from source data associated with corresponding
data model.</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>ws (xlrd.sheet.Sheet): XLRD worksheet object.
model (class): SqlAlchemy model class.</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.create_db">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">create_db</code><span class="sig-paren">(</span><em>name: str = 'pmaapi'</em>, <em>with_schema: bool = True</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.create_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a brand new database</p>
<dl class="docutils">
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>Creates database</li>
<li>Creates database tables and schema (if with_schema)</li>
</ul>
</dd>
<dt>Args:</dt>
<dd>name (str): Name of database to create
with_schema (bool): Also create all tables and initialize them?</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.create_superuser">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">create_superuser</code><span class="sig-paren">(</span><em>name: str = 'admin'</em>, <em>pw: str = 'KillaByte2020!'</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.create_superuser" title="Permalink to this definition">¶</a></dt>
<dd><p>Create default super user</p>
<p>The current iteration of PMA API only allows for one user, the super user.
During DB initialization, this function is run. If there are no existing,
users it will create the super user, else does nothing.</p>
<dl class="docutils">
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>Creates a new user in db with max privileges</li>
</ul>
</dd>
<dt>Args:</dt>
<dd>name (str): Username
pw (str): Plain text for password</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.dataset_version_to_name">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">dataset_version_to_name</code><span class="sig-paren">(</span><em>version_number: int</em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#pma_api.manage.db_mgmt.dataset_version_to_name" title="Permalink to this definition">¶</a></dt>
<dd><p>From dataset version number, get dataset name</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>version_number (int): Version number of dataset file</dd>
<dt>Raises:</dt>
<dd>FileNotFoundError: If dataset version not found on S3.</dd>
<dt>Returns:</dt>
<dd>str: Dataset name</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.delete_backup">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">delete_backup</code><span class="sig-paren">(</span><em>filename: str</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.delete_backup" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete backup file from storage</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>filename (str): Name of file</dd>
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>deletes file</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.delete_dataset">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">delete_dataset</code><span class="sig-paren">(</span><em>version_number: int</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.delete_dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Delete dataset from storage</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>version_number (int): Version of dataset to delete</dd>
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>deletes file</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.delete_s3_file">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">delete_s3_file</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.delete_s3_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapped function</p>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.download_dataset">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">download_dataset</code><span class="sig-paren">(</span><em>version_number: int</em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#pma_api.manage.db_mgmt.download_dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Download dataset file from AWS S3</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>version_number (int): Version number of dataset file to download</dd>
<dt>Returns:</dt>
<dd>str: Path to downloaded file</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.download_file_from_s3">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">download_file_from_s3</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.download_file_from_s3" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapped function</p>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.drop_tables">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">drop_tables</code><span class="sig-paren">(</span><em>tables: Iterable[sqlalchemy.sql.schema.Table] = None</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.drop_tables" title="Permalink to this definition">¶</a></dt>
<dd><p>Drop database tables</p>
<dl class="docutils">
<dt>Side effects</dt>
<dd><ul class="first last simple">
<li>Drops database tables</li>
</ul>
</dd>
<dt>Args:</dt>
<dd>tables list(db.Model): Tables to drop</dd>
<dt>Raises:</dt>
<dd>OperationalError: If encounters such an error that is not ‘database
does not exist’</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.format_book">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">format_book</code><span class="sig-paren">(</span><em>wb: xlrd.book.Book</em><span class="sig-paren">)</span> &#x2192; xlrd.book.Book<a class="headerlink" href="#pma_api.manage.db_mgmt.format_book" title="Permalink to this definition">¶</a></dt>
<dd><p>Format workbook by making edits to prevent edge case errors</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>wb (xlrd.book.Book): workbook object</dd>
<dt>Returns:</dt>
<dd>xlrd.book.Book: Formatted workbook</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.get_api_data">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">get_api_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.get_api_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Get API data.</p>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.get_data_file_by_glob">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">get_data_file_by_glob</code><span class="sig-paren">(</span><em>pattern</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.get_data_file_by_glob" title="Permalink to this definition">¶</a></dt>
<dd><p>Get file by glob.</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>pattern (str): A glob pattern.</dd>
<dt>Returns:</dt>
<dd>str: Path/to/first_file_found</dd>
<dt>Raises:</dt>
<dd>PmaApiException: If more was found than expected</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.get_datasheet_names">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">get_datasheet_names</code><span class="sig-paren">(</span><em>wb: xlrd.book.Book</em><span class="sig-paren">)</span> &#x2192; List[str]<a class="headerlink" href="#pma_api.manage.db_mgmt.get_datasheet_names" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets data sheet names from a workbook</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>wb (Book): Pre-loaded XLRD Workbook obj</dd>
<dt>Returns:</dt>
<dd>list(str): List of datasheet names</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.get_ui_data">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">get_ui_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.get_ui_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Get API data.</p>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.grant_full_permissions_to_file">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">grant_full_permissions_to_file</code><span class="sig-paren">(</span><em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.grant_full_permissions_to_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Grant access to file</p>
<dl class="docutils">
<dt>Raises:</dt>
<dd>PmaApiException: If errors during process</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.init_from_source">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">init_from_source</code><span class="sig-paren">(</span><em>path</em>, <em>model</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.init_from_source" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize DB table data from csv file.</p>
<p>Initialize table data from csv source data files associated with the
corresponding data model.</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path to csv data file.
model (class): SqlAlchemy model class.</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.is_db_empty">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">is_db_empty</code><span class="sig-paren">(</span><em>_app: flask.app.Flask = &lt;LocalProxy unbound&gt;</em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#pma_api.manage.db_mgmt.is_db_empty" title="Permalink to this definition">¶</a></dt>
<dd><p>Is database empty or not?</p>
<p>Empty is defined here as a DB that has been created, but has no tables. As
a proxy for this ideal way of telling if DB is empty, this function
currently just checks if there is any data in the ‘data’ table.</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>_app (Flask): Flask application for context</dd>
<dt>Returns:</dt>
<dd>bool: True if empty, else False</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.list_backups">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">list_backups</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; {&lt;class 'str'&gt;: [&lt;class 'str'&gt;]}<a class="headerlink" href="#pma_api.manage.db_mgmt.list_backups" title="Permalink to this definition">¶</a></dt>
<dd><p>List available backups</p>
<dl class="docutils">
<dt>Returns:</dt>
<dd>dict: available backups, of form…
{‘local’: […], ‘cloud’: […]</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.list_cloud_backups">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">list_cloud_backups</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; [&lt;class 'str'&gt;]<a class="headerlink" href="#pma_api.manage.db_mgmt.list_cloud_backups" title="Permalink to this definition">¶</a></dt>
<dd><p>List available cloud backups</p>
<dl class="docutils">
<dt>Returns:</dt>
<dd>list: backups</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.list_cloud_datasets">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">list_cloud_datasets</code><span class="sig-paren">(</span><em>detailed: bool = True</em><span class="sig-paren">)</span> &#x2192; Union[List[str], List[Dict[str, str]]]<a class="headerlink" href="#pma_api.manage.db_mgmt.list_cloud_datasets" title="Permalink to this definition">¶</a></dt>
<dd><p>List pma api dataset spec files on AWS S3</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>detailed (bool): ‘detailed’ param to pass down to
list_filtered_s3_files function.</dd>
<dt>Returns:</dt>
<dd>list: List of file names if not detailed, else list of objects
containing file names and metadata.</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.list_cloud_ui_data">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">list_cloud_ui_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; [&lt;class 'str'&gt;]<a class="headerlink" href="#pma_api.manage.db_mgmt.list_cloud_ui_data" title="Permalink to this definition">¶</a></dt>
<dd><p>List ui data spec files on AWS S3</p>
<dl class="docutils">
<dt>Returns:</dt>
<dd>list: List of files</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.list_datasets">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">list_datasets</code><span class="sig-paren">(</span><em>detailed: bool = True</em><span class="sig-paren">)</span> &#x2192; Dict[str, List[Union[str, Dict[str, str]]]]<a class="headerlink" href="#pma_api.manage.db_mgmt.list_datasets" title="Permalink to this definition">¶</a></dt>
<dd><p>List available api data spec files</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>detailed (bool): ‘detailed’ param to pass down to list_cloud_datasets()</dd>
<dt>Returns:</dt>
<dd>dict: available backups, of form…
{‘local’: […], ‘cloud’: […]</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.list_filtered_s3_files">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">list_filtered_s3_files</code><span class="sig-paren">(</span><em>path: str</em>, <em>detailed: bool = True</em>, <em>include_e_tag: bool = True</em><span class="sig-paren">)</span> &#x2192; Union[List[str], List[Dict[str, str]]]<a class="headerlink" href="#pma_api.manage.db_mgmt.list_filtered_s3_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Gets list of S3 files w/ directories and path prefixes filtered out</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path to directory holding files
detailed (bool): Print more than just object/file name? E.g. default
metadata regarding upload date, custom metadata such as file version,
etc.
include_e_tag (bool): Include AWS S3 auto-generated unique e_tag
identifiers? If true, any object dictionaries returned will include
the first 6 characters of the e_tag under the key ‘id’.</dd>
<dt>Returns:</dt>
<dd>list: Filenames</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.list_local_backups">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">list_local_backups</code><span class="sig-paren">(</span><em>path: str = '/Users/joeflack4/projects/pma-api/data/db_backups'</em><span class="sig-paren">)</span> &#x2192; [&lt;class 'str'&gt;]<a class="headerlink" href="#pma_api.manage.db_mgmt.list_local_backups" title="Permalink to this definition">¶</a></dt>
<dd><p>List available local backups</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path to backups directory</dd>
<dt>Returns:</dt>
<dd>list: backups</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.list_local_datasets">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">list_local_datasets</code><span class="sig-paren">(</span><em>path: str = '/Users/joeflack4/projects/pma-api/data'</em><span class="sig-paren">)</span> &#x2192; [&lt;class 'str'&gt;]<a class="headerlink" href="#pma_api.manage.db_mgmt.list_local_datasets" title="Permalink to this definition">¶</a></dt>
<dd><p>List available local datasets</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path to datasets directory</dd>
<dt>Returns:</dt>
<dd>list: datasets</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.list_local_files">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">list_local_files</code><span class="sig-paren">(</span><em>path: str</em>, <em>name_contains: str = ''</em><span class="sig-paren">)</span> &#x2192; [&lt;class 'str'&gt;]<a class="headerlink" href="#pma_api.manage.db_mgmt.list_local_files" title="Permalink to this definition">¶</a></dt>
<dd><p>List applicable files in directory</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path to a directory containing files
name_contains (str): Additional filter to discard any files that do not
contain this string</dd>
<dt>Returns:</dt>
<dd>list: files</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.list_local_ui_data">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">list_local_ui_data</code><span class="sig-paren">(</span><em>path: str = '/Users/joeflack4/projects/pma-api/data'</em><span class="sig-paren">)</span> &#x2192; [&lt;class 'str'&gt;]<a class="headerlink" href="#pma_api.manage.db_mgmt.list_local_ui_data" title="Permalink to this definition">¶</a></dt>
<dd><p>List available local backups</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path to backups directory</dd>
<dt>Returns:</dt>
<dd>list: backups</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.list_s3_objects">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">list_s3_objects</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.list_s3_objects" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapped function</p>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.list_ui_data">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">list_ui_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; {&lt;class 'str'&gt;: [&lt;class 'str'&gt;]}<a class="headerlink" href="#pma_api.manage.db_mgmt.list_ui_data" title="Permalink to this definition">¶</a></dt>
<dd><p>List available ui data spec files</p>
<dl class="docutils">
<dt>Returns:</dt>
<dd>dict: available backups, of form…
{‘local’: […], ‘cloud’: […]</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.make_shell_context">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">make_shell_context</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.make_shell_context" title="Permalink to this definition">¶</a></dt>
<dd><p>Make shell context, for the ability to manipulate these db_models/tables
from the command line shell.</p>
<dl class="docutils">
<dt>Returns:</dt>
<dd>dict: Context for application manager shell.</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.new_backup_path">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">new_backup_path</code><span class="sig-paren">(</span><em>_os: str = ''</em>, <em>_env: str = ''</em>, <em>ext: str = 'dump'</em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#pma_api.manage.db_mgmt.new_backup_path" title="Permalink to this definition">¶</a></dt>
<dd><p>Backup default path</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>_os (str): Operating system backup is being created on. Useful to add
this if backing up remotely. Otherwise, backup name will
reflect the OS of current system.
_env (str): Environment name where backup is being created. Useful to
add  if backing up remotely. Otherwise, backup name will
reflect the environment of current system.
ext (str): File extension to use</dd>
<dt>Returns:</dt>
<dd>str: Default path of backup file at specific date and time</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.register_administrative_metadata">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">register_administrative_metadata</code><span class="sig-paren">(</span><em>wb_path</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.register_administrative_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Create metadata for Excel Workbook files imported into the DB.</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>wb_path (str) Path to Excel Workbook.</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.remove_stata_undefined_token_from_wb">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">remove_stata_undefined_token_from_wb</code><span class="sig-paren">(</span><em>wb: xlrd.book.Book</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.remove_stata_undefined_token_from_wb" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all instances of Stata undefined token ‘.’ from wb</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>wb (xlrd.book.Book): workbook object</dd>
<dt>Returns:</dt>
<dd>xlrd.book.Book: Formatted workbook</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.restore_db">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">restore_db</code><span class="sig-paren">(</span><em>path_or_filename: str</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.restore_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Restore database</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path_or_filename (str): Either path to a backup file, or file name. If
file name, will restore from local backup if file exists in default
backups directory, else will restore from the cloud.</dd>
<dt>Side effects:</dt>
<dd>Reverts database to state of backup file</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.restore_db_cloud">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">restore_db_cloud</code><span class="sig-paren">(</span><em>filename: str</em>, <em>silent: bool = False</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.restore_db_cloud" title="Permalink to this definition">¶</a></dt>
<dd><p>Restore database</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>filename (str): Name of file to restore
silent (bool): Don’t print updates?</dd>
<dt>Side effects:</dt>
<dd>Reverts database to state of backup file</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.restore_db_local">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">restore_db_local</code><span class="sig-paren">(</span><em>path: str</em>, <em>silent: bool = False</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.restore_db_local" title="Permalink to this definition">¶</a></dt>
<dd><p>Restore database</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path to backup file
silent (bool): Don’t print updates?</dd>
<dt>Side effects:</dt>
<dd>Reverts database to state of backup file</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.restore_using_heroku_postgres">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">restore_using_heroku_postgres</code><span class="sig-paren">(</span><em>s3_url: str = ''</em>, <em>s3_url_is_signed: bool = False</em>, <em>app_name: str = ''</em>, <em>silent: bool = False</em>, <em>ok_tells: tuple = ('Restoring... done'</em>, <em>)</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.restore_using_heroku_postgres" title="Permalink to this definition">¶</a></dt>
<dd><p>Restore Heroku PostgreSQL DB using Heroku CLI</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>s3_url (str): AWS S3 unsigned object url. If signed, should pass
‘s3_url_is_signed’ param as True.
s3_url_is_signed (bool): Is this a S3 signed url? If not, will attempt
to sign before doing restore.
app_name (str): Name of app as recognized by Heroku
silent (bool): Don’t print updates?
ok_tells (tuple(str)): A list of strings to look for in the command
result output. If any given ‘tell’ strings are in the output, we will
consider the result to be ok. It is important to note that if using a
different version of the Heroku CLI, it is possible that the output
will appear to be different. If so, try to find another ‘ok tell’
inside the output, and add it to the list.</dd>
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>Signs url if needed</li>
<li>Restores database</li>
<li>Drops any tables and other database objects before recreating them</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.restore_using_pgrestore">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">restore_using_pgrestore</code><span class="sig-paren">(</span><em>path: str</em>, <em>attempt: int = 1</em>, <em>dropdb: bool = False</em>, <em>silent: bool = False</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.restore_using_pgrestore" title="Permalink to this definition">¶</a></dt>
<dd><p>Restore postgres datagbase using pg_restore</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path of file to restore
attempt (int): Attempt number
dropdb (bool): Drop database in process?
silent (bool): Don’t print updates?</dd>
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>Restores database</li>
<li>Drops database (if dropdb)</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.s3_signed_url">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">s3_signed_url</code><span class="sig-paren">(</span><em>url: str</em>, <em>sleep: int = 1</em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#pma_api.manage.db_mgmt.s3_signed_url" title="Permalink to this definition">¶</a></dt>
<dd><p>From an unsigned AWS S3 object URL, generates and returns signed one.</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>url (str): Unsigned AWS S3 object URL
sleep (int): Amount of time, in seconds,  to sleep after creating URL.
Useful for combining with another operation which will use generated
URL.</dd>
<dt>Returns:</dt>
<dd>str: Signed AWS S3 URL for object</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.seed_users">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">seed_users</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.seed_users" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates users for fresh instance; currently just a superuser</p>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.store_file_on_s3">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">store_file_on_s3</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.store_file_on_s3" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapped function</p>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.superuser_dbms_connection">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">superuser_dbms_connection</code><span class="sig-paren">(</span><em>connection_url: str = 'postgresql://postgres:postgres&#64;localhost:5432/postgres'</em><span class="sig-paren">)</span> &#x2192; sqlalchemy.engine.base.Connection<a class="headerlink" href="#pma_api.manage.db_mgmt.superuser_dbms_connection" title="Permalink to this definition">¶</a></dt>
<dd><p>Connect to database management system as a super user</p>
<dl class="docutils">
<dt>Returns:</dt>
<dd>sqlalchemy.engine.Connection: connection object</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.db_mgmt.update_pgpass">
<code class="descclassname">pma_api.manage.db_mgmt.</code><code class="descname">update_pgpass</code><span class="sig-paren">(</span><em>creds: str</em>, <em>path: str = '/Users/joeflack4/.pgpass'</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.db_mgmt.update_pgpass" title="Permalink to this definition">¶</a></dt>
<dd><p>Update pgpass file with credentials</p>
<dl class="docutils">
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>Updates file</li>
<li>Creates file if does not exist</li>
</ul>
</dd>
<dt>Args:</dt>
<dd>creds (str): Url pattern string containing connection credentials
path (str): Path to pgpass file</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-pma_api.manage.functional_subtask">
<span id="pma-api-manage-functional-subtask-module"></span><h2>pma_api.manage.functional_subtask module<a class="headerlink" href="#module-pma_api.manage.functional_subtask" title="Permalink to this headline">¶</a></h2>
<p>Functional Subtask</p>
<dl class="class">
<dt id="pma_api.manage.functional_subtask.FunctionalSubtask">
<em class="property">class </em><code class="descclassname">pma_api.manage.functional_subtask.</code><code class="descname">FunctionalSubtask</code><span class="sig-paren">(</span><em>name: str</em>, <em>prints: str</em>, <em>pct_starts_at: float</em>, <em>func: Callable = None</em>, <em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.functional_subtask.FunctionalSubtask" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A single granule of a multistep task; runs a simple function.</p>
<p>Can be sync or async.</p>
<dl class="method">
<dt id="pma_api.manage.functional_subtask.FunctionalSubtask.func">
<code class="descname">func</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.functional_subtask.FunctionalSubtask.func" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs function w/ arguments ‘args’ or keyword arguments ‘kwargs’.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-pma_api.manage.initdb_from_wb">
<span id="pma-api-manage-initdb-from-wb-module"></span><h2>pma_api.manage.initdb_from_wb module<a class="headerlink" href="#module-pma_api.manage.initdb_from_wb" title="Permalink to this headline">¶</a></h2>
<p>Database management</p>
<dl class="class">
<dt id="pma_api.manage.initdb_from_wb.InitDbFromWb">
<em class="property">class </em><code class="descclassname">pma_api.manage.initdb_from_wb.</code><code class="descname">InitDbFromWb</code><span class="sig-paren">(</span><em>_app: flask.app.Flask = &lt;LocalProxy unbound&gt;</em>, <em>api_file_path: str = '/Users/joeflack4/projects/pma-api/data/api_data-2019.01.22-v36-jef.xlsx'</em>, <em>ui_file_path: str = '/Users/joeflack4/projects/pma-api/data/ui_data-2017.10.02-v4-jef.xlsx'</em>, <em>silent: bool = False</em>, <em>callback: Generator = None</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.initdb_from_wb.InitDbFromWb" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#pma_api.manage.multistep_task.MultistepTask" title="pma_api.manage.multistep_task.MultistepTask"><code class="xref py py-class docutils literal notranslate"><span class="pre">pma_api.manage.multistep_task.MultistepTask</span></code></a></p>
<p>From a Workbook object, initialize database.</p>
<dl class="docutils">
<dt># TODO 2019-04-02 jef</dt>
<dd><ul class="first last simple">
<li>For some reason, geography label_id arent being populated</li>
</ul>
</dd>
</dl>
<dl class="method">
<dt id="pma_api.manage.initdb_from_wb.InitDbFromWb.create_onload_subtasks">
<code class="descname">create_onload_subtasks</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; collections.OrderedDict<a class="headerlink" href="#pma_api.manage.initdb_from_wb.InitDbFromWb.create_onload_subtasks" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a list of collection of subtask dict objects</p>
<dl class="docutils">
<dt>Returns:</dt>
<dd>OrderedDict: Collection of subtask objects</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="pma_api.manage.initdb_from_wb.InitDbFromWb.create_subtasks">
<code class="descname">create_subtasks</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; collections.OrderedDict<a class="headerlink" href="#pma_api.manage.initdb_from_wb.InitDbFromWb.create_subtasks" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a list of collection of subtask dict objects</p>
<dl class="docutils">
<dt>Returns:</dt>
<dd>OrderedDict: Collection of subtask objects</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="pma_api.manage.initdb_from_wb.InitDbFromWb.init_api_data_worksheet">
<code class="descname">init_api_data_worksheet</code><span class="sig-paren">(</span><em>sheetname: str</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.initdb_from_wb.InitDbFromWb.init_api_data_worksheet" title="Permalink to this definition">¶</a></dt>
<dd><p>Init data worksheet</p>
<dl class="docutils">
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>Creates records in db</li>
<li>Creates instance attributes if not already exist</li>
</ul>
</dd>
<dt>Args:</dt>
<dd>sheetname (str): Name of worksheet containing data</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="pma_api.manage.initdb_from_wb.InitDbFromWb.init_api_worksheet">
<code class="descname">init_api_worksheet</code><span class="sig-paren">(</span><em>sheetname: str</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.initdb_from_wb.InitDbFromWb.init_api_worksheet" title="Permalink to this definition">¶</a></dt>
<dd><p>Init metadata worksheet</p>
<dl class="docutils">
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>commit_from_sheet</li>
</ul>
</dd>
<dt>Args:</dt>
<dd>sheetname (str): Name of worksheet for a model
<a href="#id1"><span class="problematic" id="id2">**</span></a>kwargs: Additional keyword arguments to unpack and repack
into init_from_worksheet.</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="pma_api.manage.initdb_from_wb.InitDbFromWb.init_client_ui_data">
<code class="descname">init_client_ui_data</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.initdb_from_wb.InitDbFromWb.init_client_ui_data" title="Permalink to this definition">¶</a></dt>
<dd><p>Load client UI language data into DB</p>
<dl class="docutils">
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>xlrd.open_workbook</li>
<li>commit_from_sheet</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="pma_api.manage.initdb_from_wb.InitDbFromWb.load_api_wb">
<code class="descname">load_api_wb</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.initdb_from_wb.InitDbFromWb.load_api_wb" title="Permalink to this definition">¶</a></dt>
<dd><p>Load API workbook data into memory as instance attr</p>
<dl class="docutils">
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>Reads file</li>
<li>Sets attribute</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="pma_api.manage.initdb_from_wb.InitDbFromWb.load_source_data_files">
<code class="descname">load_source_data_files</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.initdb_from_wb.InitDbFromWb.load_source_data_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Load data necessary to initialize DB.</p>
<dl class="docutils">
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>self.load_api_wb</li>
<li>self.load_ui_wb</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="pma_api.manage.initdb_from_wb.InitDbFromWb.load_ui_wb">
<code class="descname">load_ui_wb</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.initdb_from_wb.InitDbFromWb.load_ui_wb" title="Permalink to this definition">¶</a></dt>
<dd><p>Load UI workbook data into memory as instance attr</p>
<dl class="docutils">
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>Reads file</li>
<li>Sets attribute</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="pma_api.manage.initdb_from_wb.InitDbFromWb.restore_msg">
<code class="descname">restore_msg</code><em class="property"> = 'An issue occurred. Restoring database to state it was in prior to task initialization.'</em><a class="headerlink" href="#pma_api.manage.initdb_from_wb.InitDbFromWb.restore_msg" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="pma_api.manage.initdb_from_wb.InitDbFromWb.run">
<code class="descname">run</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Dict<a class="headerlink" href="#pma_api.manage.initdb_from_wb.InitDbFromWb.run" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a fresh database instance.</p>
<p>Runs task execution, handles errors, and reports result.</p>
<dl class="docutils">
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>Runs subtasks</li>
<li>Sets attributes</li>
</ul>
</dd>
<dt>Raises:</dt>
<dd>PmaApiDbInteractionError: If tried to recover from issues but
failed.</dd>
<dt>Returns:</dt>
<dd>dict: Final results</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="pma_api.manage.initdb_from_wb.InitDbFromWb.set_relational_metadata">
<code class="descname">set_relational_metadata</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.initdb_from_wb.InitDbFromWb.set_relational_metadata" title="Permalink to this definition">¶</a></dt>
<dd><p>Set instance attrs for required relational keys for ‘Data’ upload</p>
<dl class="docutils">
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>setattr</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="pma_api.manage.initdb_from_wb.InitDbFromWb.task_name">
<code class="descname">task_name</code><em class="property"> = 'Initializing database from {}'</em><a class="headerlink" href="#pma_api.manage.initdb_from_wb.InitDbFromWb.task_name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-pma_api.manage.multistep_task">
<span id="pma-api-manage-multistep-task-module"></span><h2>pma_api.manage.multistep_task module<a class="headerlink" href="#module-pma_api.manage.multistep_task" title="Permalink to this headline">¶</a></h2>
<p>Multistep Task super class</p>
<dl class="class">
<dt id="pma_api.manage.multistep_task.MultistepTask">
<em class="property">class </em><code class="descclassname">pma_api.manage.multistep_task.</code><code class="descname">MultistepTask</code><span class="sig-paren">(</span><em>silent: bool = False</em>, <em>name: str = ''</em>, <em>callback: Generator = None</em>, <em>subtasks: Dict = None</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.multistep_task.MultistepTask" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A synchronous multi-step task</p>
<p>Subtasks groups are of the form:
Dict[str, Dict[str, Union[str, int, Callable]]] = {</p>
<blockquote>
<div><dl class="docutils">
<dt>‘subtask_1_name’: {</dt>
<dd>‘prints’: ‘Doing first thing’,
‘pct_starts_at’: 0</dd>
</dl>
<p>},
‘subtask_2_name’: {</p>
<blockquote>
<div>‘prints’: ‘Doing second thing’,
‘pct_starts_at’: 10</div></blockquote>
<p>…</p>
</div></blockquote>
<p>}</p>
<dl class="docutils">
<dt>Or it could be of the form:</dt>
<dd>‘subtask_1_name’: &lt;subtask obj&gt;</dd>
</dl>
<p>This class is meant to be used either by itself, in which print statements
are typically made to show task progress, or in tandem with a task queue
such as Celery, where a callback is utilized to report progress.</p>
<p>With each call to <cite>begin(&lt;subtask&gt;)</cite>, progress is reported, utilizing each
sub-task objects’ print statement and percentage. When creating a sub-task
to build up a sub-task dictionary as shown above, it is necessary to assign
semi-arbitrary percentages. These percentages will represent the task
authors’ best guess at how long a task should take.</p>
<dl class="method">
<dt id="pma_api.manage.multistep_task.MultistepTask.begin">
<code class="descname">begin</code><span class="sig-paren">(</span><em>subtask_name: str = ''</em>, <em>subtask_queue: collections.OrderedDict = None</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.multistep_task.MultistepTask.begin" title="Permalink to this definition">¶</a></dt>
<dd><p>Register and report task or subtask begin</p>
<dl class="docutils">
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>self._begin_multistep_task</li>
<li>self._begin_subtask</li>
</ul>
</dd>
<dt>Args:</dt>
<dd>subtask_name: Name of subtask to report running. If absent,
prints that task has already begun.
subtask_queue: Ordered dictionary of subtasks to run</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="pma_api.manage.multistep_task.MultistepTask.complete">
<code class="descname">complete</code><span class="sig-paren">(</span><em>seconds_elapsed: int = None</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.multistep_task.MultistepTask.complete" title="Permalink to this definition">¶</a></dt>
<dd><p>Register and report all sub-tasks and task itself complete</p>
</dd></dl>

<dl class="attribute">
<dt id="pma_api.manage.multistep_task.MultistepTask.start_status">
<code class="descname">start_status</code><em class="property"> = 'PENDING'</em><a class="headerlink" href="#pma_api.manage.multistep_task.MultistepTask.start_status" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
<div class="section" id="module-pma_api.manage.server_mgmt">
<span id="pma-api-manage-server-mgmt-module"></span><h2>pma_api.manage.server_mgmt module<a class="headerlink" href="#module-pma_api.manage.server_mgmt" title="Permalink to this headline">¶</a></h2>
<p>Server management</p>
<dl class="function">
<dt id="pma_api.manage.server_mgmt.get_server_pid">
<code class="descclassname">pma_api.manage.server_mgmt.</code><code class="descname">get_server_pid</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.server_mgmt.get_server_pid" title="Permalink to this definition">¶</a></dt>
<dd><p>Get process id of this server being run</p>
<dl class="docutils">
<dt>Returns:</dt>
<dd>int: process id</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.server_mgmt.start_dev_server">
<code class="descclassname">pma_api.manage.server_mgmt.</code><code class="descname">start_dev_server</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.server_mgmt.start_dev_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Start development server</p>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.server_mgmt.start_prod_server">
<code class="descclassname">pma_api.manage.server_mgmt.</code><code class="descname">start_prod_server</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.server_mgmt.start_prod_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Start production server</p>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.server_mgmt.start_server">
<code class="descclassname">pma_api.manage.server_mgmt.</code><code class="descname">start_server</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.server_mgmt.start_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Start server</p>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.server_mgmt.stop_server">
<code class="descclassname">pma_api.manage.server_mgmt.</code><code class="descname">stop_server</code><span class="sig-paren">(</span><em>pid: int = None</em>, <em>pid_file_path: str = '/Users/joeflack4/projects/pma-api/pma-api_process-id.pid'</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.server_mgmt.stop_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Stop server</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>pid (int): Process id
pid_file_path (str): Path to read/write pid file</dd>
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>Stops server</li>
<li>Writes to pid file</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.server_mgmt.store_pid">
<code class="descclassname">pma_api.manage.server_mgmt.</code><code class="descname">store_pid</code><span class="sig-paren">(</span><em>path: str = '/Users/joeflack4/projects/pma-api/pma-api_process-id.pid'</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.server_mgmt.store_pid" title="Permalink to this definition">¶</a></dt>
<dd><p>Store prcocess id</p>
<p>This should be called in the module used to run the server, right before
any lines to execute running server</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>path (str): Path to file to store process id</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-pma_api.manage.utils">
<span id="pma-api-manage-utils-module"></span><h2>pma_api.manage.utils module<a class="headerlink" href="#module-pma_api.manage.utils" title="Permalink to this headline">¶</a></h2>
<p>App management utilities</p>
<dl class="function">
<dt id="pma_api.manage.utils.get_table_models">
<code class="descclassname">pma_api.manage.utils.</code><code class="descname">get_table_models</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; tuple<a class="headerlink" href="#pma_api.manage.utils.get_table_models" title="Permalink to this definition">¶</a></dt>
<dd><p>Get list of all db tables</p>
<dl class="docutils">
<dt>Returns:</dt>
<dd>tuple: All db tables</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.utils.log_process_stderr">
<code class="descclassname">pma_api.manage.utils.</code><code class="descname">log_process_stderr</code><span class="sig-paren">(</span><em>stderr_obj</em>, <em>err_msg: str = None</em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#pma_api.manage.utils.log_process_stderr" title="Permalink to this definition">¶</a></dt>
<dd><p>Log stderr output from process</p>
<dl class="docutils">
<dt>Side effects:</dt>
<dd><ul class="first last simple">
<li>Makes directory (if doesn’t exist)</li>
<li>Writes to logfile (if error message)</li>
</ul>
</dd>
<dt>Args:</dt>
<dd>stderr_obj: Stderr object
err_msg (str): Custom error message</dd>
<dt>Returns:</dt>
<dd>str: errors</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.utils.run_proc">
<code class="descclassname">pma_api.manage.utils.</code><code class="descname">run_proc</code><span class="sig-paren">(</span><em>cmd</em>, <em>shell: bool = False</em>, <em>raises: bool = True</em>, <em>prints: bool = False</em><span class="sig-paren">)</span> &#x2192; Dict[str, str]<a class="headerlink" href="#pma_api.manage.utils.run_proc" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a process</p>
<p>Wrapper for run_proc_simple. Only adds exception handling.</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>cmd (str | list): Command to run
shell (bool): Shell argument to pass to subprocess.Popen
raises (bool): Raise exceptions?
prints (bool): Print captured stderr and stdout? Prints both to stdout.</dd>
<dt>Raises:</dt>
<dd>PmaApiDbInteractionError: If output[‘stderr’]</dd>
<dt>Returns:</dt>
<dd><dl class="first docutils">
<dt>dict: {</dt>
<dd>‘stdout’: Popen.stdout.read(),
‘stderr’: Popen.stderr.read()</dd>
</dl>
<p class="last">}</p>
</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.utils.run_proc_and_log_errs">
<code class="descclassname">pma_api.manage.utils.</code><code class="descname">run_proc_and_log_errs</code><span class="sig-paren">(</span><em>cmd: List</em><span class="sig-paren">)</span><a class="headerlink" href="#pma_api.manage.utils.run_proc_and_log_errs" title="Permalink to this definition">¶</a></dt>
<dd><p>Run process and log errors, if any</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>cmd (list): Command to be executed to run process</dd>
</dl>
</dd></dl>

<dl class="function">
<dt id="pma_api.manage.utils.run_proc_simple">
<code class="descclassname">pma_api.manage.utils.</code><code class="descname">run_proc_simple</code><span class="sig-paren">(</span><em>cmd</em>, <em>shell: bool = False</em><span class="sig-paren">)</span> &#x2192; Dict[str, str]<a class="headerlink" href="#pma_api.manage.utils.run_proc_simple" title="Permalink to this definition">¶</a></dt>
<dd><p>Run a process</p>
<p>Helper function to run a process, for boilerplate reduction.</p>
<dl class="docutils">
<dt>Args:</dt>
<dd>cmd (str | list): Command to run
shell (bool): Shell argument to pass to subprocess.Popen</dd>
<dt>Returns:</dt>
<dd><dl class="first docutils">
<dt>dict: {</dt>
<dd>‘stdout’: Popen.stdout.read(),
‘stderr’: Popen.stderr.read()</dd>
</dl>
<p class="last">}</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-pma_api.manage">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-pma_api.manage" title="Permalink to this headline">¶</a></h2>
<p>Init</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, James Pringle, Joe Flack

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>